<html>
<style>
body {
  background-color: black;
}

#wrapper {
  width: 1200px;
  margin: 0 auto;
}

#info {
  font-family: sans-serif;
  position: absolute;
  top: 0;
  right: 50px;
  color: white;
}

</style>
<body>
  <div id="wrapper">
    <canvas id="mycanvas" width="1200" height="800"></canvas>
  </div>

  <div id="info"></div>

  <script src="../js/lodash.min.js"></script>
  <script src="../js/d3.v3.min.js"></script>
  <script src="../js/arrastre-util.js"></script>
  <script>


  // BIGDATA
  // For a single skeleton, each joint position is represented with 3 points (one for each co-ordinate). Each joint has a unique colour.
  // The value of each co-ordinate is mapped to the y-axis. The x-axis is random.

  function poll() {
    d3.json('/playbackServer/api/data.json', function(err, json) {
      if(json === undefined) return;

      var data = getDataOfSkeleton(json, 0);

      ctx.globalAlpha = 1;
      ctx.fillStyle = "rgba(0, 0, 0, 0.02)";
      ctx.fillRect(0, 0, width, height);
 
      var indexThreshold = indexScale(Date.now() - startTime);
      // d3.select('#info').text(indexThreshold);

      _.each(data, function(d, index) {
        if(index > indexThreshold)
          return;

        var x = Math.random() * width;
        var y = scale(d) % height;
        ctx.fillStyle = color(index % 20);
        drawCircle(ctx, x, y, 5);
      });
    });
  }

  var width = 1200, height = 800;

  var startTime = Date.now();

  var color = d3.scale.category20b();
  var scale = d3.scale.linear().domain([-3, 6]).range([1000, 0]);
  var indexScale = d3.scale.threshold().domain([0, 54000, 70000, 84000, 120000, 154000, 167000, 200000, 230000]).range([0, 3, 10, 40, 10, 1, 60, 20, 10, 10]);

  var canvas = document.getElementById('mycanvas');
  var ctx = canvas.getContext('2d');

  ctx.fillStyle = "rgb(0,0,0)";
  ctx.fillRect(0, 0, width, height);

  // poll()
  setInterval(poll, 50);
 
</script>
</body>
